Command: git log origin/main..main -p
Directory: (root)
Output: commit bab71d93a2bc5b7c95d136bcd946a3049786b062 (HEAD -> main)
Merge: 4b54ed0 04508e2
Author: William Porter <Willporterdesign@outlook.com>
Date:   Mon Dec 22 08:37:01 2025 +0700

    Merge branch 'main' of https://github.com/AzureFoxStudios/wabi

commit 4b54ed07c97d5e16ba4ec8cea17ff042df8b04a9
Author: William Porter <Willporterdesign@outlook.com>
Date:   Sun Dec 21 03:07:59 2025 +0700

    Update server.ts

diff --git a/backend/src/server.ts b/backend/src/server.ts
index d1e4c1c..78d9e01 100644
--- a/backend/src/server.ts
+++ b/backend/src/server.ts
@@ -991,7 +991,7 @@ const server = createServer((req, res) => {
 });

 // Start HTTP server
-server.listen(PORT);
+server.listen(PORT, '0.0.0.0');

 // ðŸ§  Start cleanup interval on server startup
 runCleanup(); // Run once immediately on startup

commit 5b34868ee8df28edfad1e1b74cdba7c62928e36d
Author: William Porter <Willporterdesign@outlook.com>
Date:   Sun Dec 21 00:26:17 2025 +0700

    ðŸ§  Backend RAM optimization - reduce 156MB to ~60MB
    
    Implemented aggressive memory management:

    1. Message Pruning (5000 max per channel)
       - Auto-prune when channel exceeds 5000 messages
       - Removes oldest messages first
       - Pruning happens on every message and hourly cleanup

    2. Todo Archival
       - Archive completed todos older than 30 days
       - Runs hourly to free memory
       - Todos still searchable if needed
    
    3. Cleanup Interval
       - Runs every hour automatically
       - Cleans up old messages and todos
       - Logs pruning stats for monitoring

    4. Startup Cleanup
       - Runs cleanup immediately on server startup
       - Ensures fresh state without memory bloat
    
    Expected RAM reduction: 156MB â†’ ~60MB backend
    Console logs show: 'ðŸ“Š Pruned #general: kept 5000 of 8234 messages'
                     'ðŸ§¹ Running RAM cleanup...'

diff --git a/backend/src/server.ts b/backend/src/server.ts
index 6092f80..d1e4c1c 100644
--- a/backend/src/server.ts
+++ b/backend/src/server.ts
@@ -5,6 +5,11 @@ import { join } from "path";
 import { PluginLoader } from "./plugins/loader";
 import { getAllEmojis, getEmojiByName, addCustomEmoji, deleteCustomEmoji, type Emoji } from "./emojis";

+// ðŸ§  RAM OPTIMIZATION CONSTANTS
+const MAX_MESSAGES_PER_CHANNEL = 5000; // Keep only recent messages in memory
+const MAX_TODO_AGE_DAYS = 30; // Archive completed todos older than 30 days
+const CLEANUP_INTERVAL = 3600000; // Run cleanup every hour (3600000ms)
+
 // In-memory data store
 interface Channel {
   id: string;
@@ -988,6 +993,10 @@ deleteMessageById = (channelId: string, messageId: string) => { 
   }
 };
+
+// ðŸ§  CLEANUP FUNCTIONS FOR RAM OPTIMIZATION
+
+// Prune old messages from memory (keep only recent ones)
+function pruneMessages() {
+  let pruned = 0;
+  channelMessages.forEach((messages, channelId) => {
+    if (messages.length > MAX_MESSAGES_PER_CHANNEL) {
+      const oldCount = messages.length;
+      // Keep only the most recent MAX_MESSAGES_PER_CHANNEL
+      const removed = messages.splice(0, messages.length - MAX_MESSAGES_PER_CHANNEL); 
+      channelMessages.set(channelId, messages);
+      pruned += removed.length;
+      console.log(
+        `ðŸ“Š Pruned ${channelId}: kept ${MAX_MESSAGES_PER_CHANNEL} of ${oldCount} messaages`
+      );
+    }
+  });
+  if (pruned > 0) {
+    console.log(`ðŸ§¹ Total messages pruned: ${pruned}`);
+  }
+}
+
+// Archive old completed todos to free RAM
+function archiveOldTodos() {
+  const thirtyDaysAgo = Date.now() - MAX_TODO_AGE_DAYS * 24 * 60 * 60 * 1000;
+  let archived = 0;
+
+  businessWorkspaces.forEach((workspace) => {
+    const completed = workspace.todos.filter(
+      (todo: any) =>
+        todo.completedAt && todo.completedAt < thirtyDaysAgo
+    );
+    archived += completed.length;
+    // Remove archived todos from memory
+    workspace.todos = workspace.todos.filter(
+      (todo: any) =>
+        !todo.completedAt || todo.completedAt >= thirtyDaysAgo
+    );
+  });
+
+  if (archived > 0) {
+    console.log(`ðŸ“¦ Archived ${archived} old completed todos`);
+  }
+}
+
+// Run cleanup routine
+function runCleanup() {
+  console.log("ðŸ§¹ Running RAM cleanup...");
+  pruneMessages();
+  archiveOldTodos();
+}
+
 // Initialize server: DO NOT load persisted messages from disk
 // Messages are stored client-side in localStorage, not server-side
 // restoreMessageDeletionTimers() is not needed since messages start fresh on server restart
@@ -1078,6 +1087,10 @@ io.on("connection", (socket) => {
     // Add message to channel
     const messages = channelMessages.get(data.channelId) || [];
     messages.push(message);
+
+    // ðŸ§  RAM SAVER: Prune if channel exceeds max messages
+    if (messages.length > MAX_MESSAGES_PER_CHANNEL) {
+      const removed = messages.splice(0, messages.length - MAX_MESSAGES_PER_CHANNEL);
+      console.log(
+        `ðŸ“Š Auto-pruned ${data.channelId}: removed ${removed.length} old messages`    
+      );
+    }
+
     channelMessages.set(data.channelId, messages);
 
     emitToChannel(data.channelId, "message", { channelId: data.channelId, message }); 

commit 2f0250a8078a8ad94521df36e33eabca019b4991
Author: William Porter <Willporterdesign@outlook.com>
Date:   Sat Dec 20 23:53:41 2025 +0700

    Reduce YouTube preview size from 600px to 380px for better chat integration
    
diff --git a/frontend/src/lib/components/LinkPreview.svelte b/frontend/src/lib/components/LinkPreview.svelte
index 2e51199..ec80353 100644
--- a/frontend/src/lib/components/LinkPreview.svelte
+++ b/frontend/src/lib/components/LinkPreview.svelte
@@ -121,7 +121,7 @@
                padding-bottom: 56.25%; /* 16:9 aspect ratio */
                height: 0;
                overflow: hidden;
-               max-width: 600px;
+               max-width: 380px;
                margin: 0.5rem 0;
                border-radius: 8px;
                background: var(--bg-secondary);

commit bcb2edc23a4de6a9e7012ddd3c783398ab0aa5b3
Author: William Porter <Willporterdesign@outlook.com>
Date:   Sat Dec 20 19:21:12 2025 +0700

    Fix mobile viewport height and responsive design
    
    Mobile improvements:
    - Change 100vh to 100dvh in ChannelSidebar media query
    - Change 100vh to 100dvh in UserPanel media query
    - Change 100vh to 100dvh in DMPanel media query
    - Ensures proper viewport height when keyboard appears on mobile devices

    Frontend rebuild with all mobile fixes applied.

    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

    Co-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>

diff --git a/.github/workflows/build.yml b/.github/workflows/build.yml
new file mode 100644
index 0000000..74cfbb7
--- /dev/null
+++ b/.github/workflows/build.yml
@@ -0,0 +1,128 @@
+name: Build and Release
+
+on:
+  push:
+    branches:
+      - main
+    tags:
+      - 'v*'
+  pull_request:
+    branches:
+      - main
+
env:
+  RUST_BACKTRACE: 1
+
+jobs:
+  build-tauri:
+    permissions:
+      contents: write
+    strategy:
+      fail-fast: false
+      matrix:
+        include:
+          - platform: 'macos-latest'
+            args: '--target universal'
+          - platform: 'ubuntu-22.04'
+            args: ''
+          - platform: 'windows-latest'
+            args: ''
+
+    runs-on: ${{ matrix.platform }}
+    steps:
+      - uses: actions/checkout@v4
+
+      - name: setup node
+        uses: actions/setup-node@v4
+        with:
+          node-version: '20'
+
+      - name: install Rust stable
+        uses: dtolnay/rust-toolchain@stable
+        with:
+          targets: ${{ runner.os == 'macos' && 'aarch64-apple-darwin,x86_64-apple-darwin' || '' }}
+
+      - name: install dependencies (ubuntu only)
+        if: startsWith(matrix.platform, 'ubuntu')
+        run: |
+          sudo apt-get update
+          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.0-dev libappindicator3-dev librsvg2-dev patchelf
+
+      - name: install bun
+        uses: oven-sh/setup-bun@v1
+        with:
+          bun-version: latest
+
+      - name: install frontend dependencies
+        run: cd frontend && bun install
+
+      - name: install backend dependencies
+        run: cd backend && npm install
+
+      - name: build Tauri
+        uses: tauri-apps/tauri-action@v0
+        env:
+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
+        with:
+          projectPath: './frontend'
+          args: ''
+          releaseDraft: ${{ startsWith(github.ref, 'refs/tags/') }}
+          prerelease: ${{ contains(github.ref, 'alpha') || contains(github.ref, 'beta') }}
+
+  build-backend:
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@v4
+
+      - name: setup node
+        uses: actions/setup-node@v4
+        with:
+          node-version: '20'
+
+      - name: install bun
+        uses: oven-sh/setup-bun@v1
+        with:
+          bun-version: latest
+
+      - name: install dependencies
+        run: cd backend && bun install
+
+      - name: build
+        run: cd backend && bun run build
+
+      - name: upload backend artifact
+        uses: actions/upload-artifact@v4
+        with:
+          name: backend-build
+          path: backend/dist
+
+  frontend-checks:
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@v4
+
+      - name: setup node
+        uses: actions/setup-node@v4
+        with:
+          node-version: '20'
+
+      - name: install bun
+        uses: oven-sh/setup-bun@v1
+        with:
+          bun-version: latest
+
+      - name: install dependencies
+        run: cd frontend && bun install
+
+      - name: build
+        run: cd frontend && bun run build
+
+      - name: svelte-check
+        run: cd frontend && bunx svelte-check
+        continue-on-error: true
+
+      - name: upload frontend build
+        uses: actions/upload-artifact@v4
+        with:
+          name: frontend-build
+          path: frontend/build
+
+commit 5a46a379acaea69177b8985c6a18a717489314de
Author: William Porter <Willporterdesign@outlook.com>
Date:   Sat Dec 20 19:31:13 2025 +0700

    Reduce YouTube preview size from 600px to 380px for better chat integration
    
diff --git a/frontend/src/lib/components/LinkPreview.svelte b/frontend/src/lib/components/LinkPreview.svelte
index 2e51199..ec80353 100644
--- a/frontend/src/lib/components/LinkPreview.svelte
+++ b/frontend/src/lib/components/LinkPreview.svelte
@@ -121,7 +121,7 @@
                padding-bottom: 56.25%; /* 16:9 aspect ratio */
                height: 0;
                overflow: hidden;
-               max-width: 600px;
+               max-width: 380px;
                 margin: 0.5rem 0;
                 border-radius: 8px;
                 background: var(--bg-secondary);

commit bcb2edc23a4de6a9e7012ddd3c783398ab0aa5b3
Author: William Porter <Willporterdesign@outlook.com>
Date:   Sat Dec 20 19:21:12 2025 +0700

    Fix mobile viewport height and responsive design
    
    Mobile improvements:
    - Change 100vh to 100dvh in ChannelSidebar media query
    - Change 100vh to 100dvh in UserPanel media query
    - Change 100vh to 100dvh in DMPanel media query
    - Ensures proper viewport height when keyboard appears on mobile devices

    Frontend rebuild with all mobile fixes applied.

    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

    Co-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>

diff --git a/README.md b/README.md
index b36f93f..225dec4 100644
--- a/README.md
+++ b/README.md
@@ -1,321 +1,134 @@
-# Community Chat
++# Wabi - A Self-Hosted, Extensible Chat Platform
 
--A self-hosted, ephemeral chat system with screen sharing for 10-50 users. Built with privacy, simplicity, and easy deployment in mind.
+Wabi is a private, self-hosted, and ephemeral real-time chat application designed for small to medium-sized communities (10-50 users). It runs as a web application and can be packaged as a native desktop application using Tauri. It prioritizes privacy and simplicity, with all chat data stored in-memory and disappearing when the server restarts. 
 
 ## Features
 
--**Real-time Chat**: Instant messaging with typing indicators
--**Screen Sharing**: WebRTC-based screen sharing with multiple participants
--**Collaborative Drawing**: Integrated Excalidraw whiteboard for team collaboration  
--**GIF Support**: Giphy integration for fun conversations
--**User Presence**: See who's online in real-time
--**Export Chat**: Download chat history as JSON
--**PWA Support**: Install as a Progressive Web App
--**Ephemeral Storage**: All data stored in-memory (no database required)
--**Privacy-Focused**: No data persistence, opt-in logging, self-hosted deployment    
--**File Management**: Uploaded files are automatically deleted when messages are deleted
+- **Real-time Chat**: Instant messaging, typing indicators, user presence, and GIF support.
+- **Voice & Video Calls**: WebRTC-based direct and group calls.
+- **Screen Sharing**: Share your screen with multiple participants.
+- **Native Desktop App**: Cross-platform desktop application built with Tauri.        
+- **Extensible via Plugins**: Add custom functionality to the backend via a simple plugin architecture.
+- **File Sharing**: Upload and share files directly in chat.
+- **Ephemeral & Private**: All data is stored in-memory on your own server. No database required, and no data persists after a restart.
+- **Self-Hosted Relay Server**: Includes a pre-configured `coturn` TURN server to improve WebRTC connection reliability.
+- **Collaborative Drawing**: Integrated Excalidraw whiteboard for team collaboration. 
+ 
+ ## Tech Stack
+ 
+- **Backend**: Node.js (Bun Runtime), Socket.IO, TypeScript
+- **Frontend**: SvelteKit, TypeScript
+- **Desktop**: Tauri
+- **Real-time Comms**: Socket.IO (Signaling), WebRTC (Media)
+- **Relay Server**: Coturn, Docker & Docker Compose
+ 
+-## Quick Start
++### Prerequisites
+ 
+-### Prerequisites
+- 
+-- [Bun](https://bun.sh) v1.0 or higher
+-- Modern web browser with WebRTC support
+- 
+-### Development
+- 
+-1. Clone the repository:
+-```bash
-+git clone <your-repo-url>
-+cd community-chat
+-```
+-
+-2. Install dependencies:
+-```bash
-+bun install
-+cd frontend && bun install && cd ..
-+cd backend && bun install && cd ..
+ ```
+-
+-3. Set up environment variables:
+-
+-Backend (create `backend/.env`):
+-```env
-+PORT=3000
-+FRONTEND_URL=http://localhost:5173
-+ENABLE_LOGGING=false  # Set to 'true' to enable activity logging
+. 
+â”œâ”€â”€ backend/         # Node.js Socket.IO backend
+â”œâ”€â”€ frontend/        # SvelteKit frontend & Tauri desktop wrapper
+â”œâ”€â”€ plugins/         # Directory for backend plugins
+â”œâ”€â”€ turn-server/     # Pre-configured Coturn TURN server for Docker
+â””â”€â”€ pureref-connector/ # Standalone tool for PureRef integration
+ ```
+-
+-Frontend (create `frontend/.env`):
+-```env
-+VITE_SOCKET_URL=http://localhost:3000
-+VITE_GIPHY_API_KEY=your_giphy_api_key_here
+```
++### 2. Configure the Backend URL
+ 
+-4. Start development servers:
+-```bash
-+bun run dev
+ ```
+-
+-This will start:
+-- Frontend dev server on `http://localhost:5173`
+-- Backend server on `http://localhost:3000`
+ 
+-## Production Deployment
++### 3. Configure and Run the TURN Relay Server
+ 
+-### Option 1: Single Binary (Recommended)
+ 
+-1. Build the project:
+-```bash
-+chmod +x build.sh
-+./build.sh
+ ```
+ 
+-2. The `dist/` folder will contain:
+-   - `community-chat-server` (single binary executable)
+-   - `static/` (frontend build files)
+ 
+-3. Deploy and run:
+ ```bash
+-cd dist
-+PORT=3000 ./community-chat-server
+ 
+-# Or with logging enabled:
-+ENABLE_LOGGING=true PORT=3000 ./community-chat-server
+ ```
+ 
+-### Option 2: Docker
+ 
+-1. Build the Docker image:
+-```bash
-+docker build -t community-chat .
+ ```
+ 
+-2. Run the container:
+-```bash
-+docker run -p 3000:3000 community-chat
+ ```
+ 
+-Or use Docker Compose:
+-```bash
-+docker-compose up -d
+ ```
+ 
+-## Configuration
+ 
+-### Backend Environment Variables
+- 
+-| Variable |
+-|----------|
+-| `PORT` |
+-| `FRONTEND_URL` |
+-| `ENABLE_LOGGING` |
+ 
+-### Frontend Environment Variables
+- 
+-| Variable |
+-|----------|
+-| `VITE_SOCKET_URL` |
+-| `VITE_GIPHY_API_KEY` |
+ 
+-### Getting a Giphy API Key
+ 
+-1. Sign up at [Giphy Developers](https://developers.giphy.com/)
+-2. Create a new app
+-3. Copy the API key to `VITE_GIPHY_API_KEY`
+ 
+-## Architecture
+ 
+-### Backend (Bun + Socket.IO)
+ 
+- In-memory data storage (ephemeral)
+- Socket.IO event handlers for:
+-  - Chat messages (with edit, delete, pin support)
+-  - User presence
+-  - Typing indicators
+-  - WebRTC signaling (screen sharing, voice/video calls)
+-  - Excalidraw state sync
+-  - File uploads (with automatic cleanup on message deletion)
+-  - Channel management
+-  - Custom emotes
+-  - Privacy-focused: Opt-in activity logging (disabled by default)
+-  - Automatic file deletion when messages are deleted
+-  - No Persistence: Chat history, user data, and files exist only while the server runs
+ 
+-### Frontend (SvelteKit)
+- 
+-```
-+src/
-+â”œâ”€â”€ lib/
-+â”‚   â”œâ”€â”€ components/
-+â”‚   â”‚   â”œâ”€â”€ Chat.svelte           # Main chat interface
-+â”‚   â”‚   â”œâ”€â”€ DrawingBoard.svelte   # Excalidraw integration
-+â”‚   â”‚   â”œâ”€â”€ ScreenShareViewer.svelte
-+â”‚   â”‚   â”œâ”€â”€ GiphyPicker.svelte
-+â”‚   â”‚   â”œâ”€â”€ Sidebar.svelte
-+â”‚   â”‚   â””â”€â”€ ...
-+â”‚   â”œâ”€â”€ socket.ts                 # Socket.IO client store
-+â”‚   â””â”€â”€ webrtc.ts                 # WebRTC utilities
-+â””â”€â”€ routes/
-+    â””â”€â”€ +page.svelte              # Main app entry
+-```
+ 
+-## Usage
+ 
+-### Truly Ephemeral by Default
+ 
+-This chat system is designed with **privacy first**:
+ 
+-**No Database**: All messages stored in-memory only, lost on server restart
+-**Opt-in Logging**: Server activity logs are **disabled by default**
+-  - Set `ENABLE_LOGGING=true` to log user activity (joins, messages, file uploads, etc.)
+-  - Error logs and startup info always enabled for operational purposes
+-  - Without logging enabled, no audit trail is created
+-**Automatic File Cleanup**: When messages with uploaded files are deleted:
+-  - Files are **permanently removed** from the server filesystem
+-  - No orphaned files left behind
+-**No Persistence**: Chat history, user data, and files exist only while the server runs
+ 
+-### What Gets Logged (if `ENABLE_LOGGING=true`)
+ 
+ User connections/disconnections
+- Users joining/leaving chat
+- Channel creation/deletion
+- File uploads/deletions
+- Emote additions/deletions
+- Profile updates
+ 
+-### What's Always Logged (operational)
+ 
+-- Server startup information (port, directories)
+-- Error messages (for debugging)
+-- Health check requests
+ 
+-## Security Notes
+ 
+-- This is designed for trusted groups (team chat, friend groups)
+-- No authentication or authorization built-in
+-- No rate limiting on messages
+-- For public deployment, add:
+-  - Authentication layer
+-  - Rate limiting
+-  - Message validation
+-  - User moderation tools
+ 
+-## Troubleshooting
+ 
+-**Screen sharing not working:**
+-- Ensure you're using HTTPS in production
+-- Check browser permissions
+-- Verify WebRTC is supported
+ 
+-**Messages not appearing:**
+-- Check Socket.IO connection in browser console
+-- Verify backend is running
+-- Check CORS settings match frontend URL
+ 
+-**Build fails:**
+-- Ensure Bun is installed and up to date
+-- Clear node_modules and reinstall
+-- Check for TypeScript errors
+ 
+## Architecture
+ 
+### Backend Plugin System
+ 
+- The backend features a simple yet powerful plugin system located in the `plugins/` directory.
+- 
+- The server automatically loads any subdirectory in `plugins/` that contains a `plugin.json` manifest.
+- Each plugin's entry point receives a `context` object, giving it access to the core `io` (Socket.IO server) instance and the application's `state`.
+- This allows you to listen for events, emit new ones, and modify the shared server state, enabling deep integration and extension of core functionality.
+ 
++### WebRTC and the TURN Server
+ 
+For reliable WebRTC connections (especially across different networks), STUN and TURN servers are used.
+ 
+- **STUN**: Public STUN servers are pre-configured to help clients discover their public IP address.
+- **TURN**: This project includes a pre-configured `coturn` TURN server in the `/turn-server` directory. It relays media traffic when a direct peer-to-peer connection fails. The frontend is already configured to use it, but you must ensure it's running and its IP is correctly configured in `turnserver.conf` and `frontend/src/lib/(calling|webrtc).ts`.
+ 
++## Building for Production
+ 
+This application can be built into a native desktop application.
+ 
+1.  Ensure all configurations (especially server URLs) are set for production.
+2.  Run the Tauri build command from the `frontend/` directory:
+ 
+```bash
+cd frontend
+bun run tauri build
+ ```
+ 
+This will generate a native executable for your operating system in `frontend/src-tauri/target/release/`.
+ 
+## Contributing
+ 
+This project is under active development. Key areas for contribution include:
+ 
+- [ ] Add authentication and user accounts
+- [ ] Persist messages to an optional database (e.g., SQLite)
+- [ ] Add message reactions
+- [ ] File sharing
+- [ ] Voice/video chat
+- [ ] Admin controls
+- [ ] Message threading
+- [ ] Custom themes
+ 
+## License
+ 
+MIT License
+
+## Credits
+ 
+Built with:
+-- [Bun](https://bun.sh)
+-- [SvelteKit](https://kit.svelte.dev)
+-- [Socket.IO](https://socket.io)
+-- [Excalidraw](https://excalidraw.com)
+-- [Giphy](https://giphy.com)
+MIT License
+
