services:
  - type: web
    name: wabi-backend
    runtime: node
    
    # Build the frontend, then backend dependencies
    buildCommand: |
      set -e
      echo "=== Building frontend ===" && \
      cd frontend && \
      npm install && \
      npm run build && \
      ls -la build/ && \
      echo "=== Frontend built successfully ===" && \
      cd ../backend && \
      echo "=== Installing backend dependencies ===" && \
      npm install && \
      echo "=== Build complete ==="
    
    # Start the backend server (serves both frontend + API)
    # Using Node directly since Render doesn't have Bun by default
    startCommand: cd backend && node src/server.ts
    
    # Environment variables
    envVars:
      - key: PORT
        value: 10000
      
      # Static files directory - explicitly set for Render
      - key: STATIC_DIR
        value: /app/frontend/build
      
      # Frontend URL for CORS (Render domain)
      - key: FRONTEND_URL
        value: https://wabi.onrender.com
      
      # Public URL for Socket.IO auto-detection
      - key: PUBLIC_URL
        value: https://wabi.onrender.com

